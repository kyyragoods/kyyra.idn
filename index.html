<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contoh Permintaan dan Respon API</title>
    <!-- Include CryptoJS library from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
</head>
<body>

<!-- Input untuk customerNo -->
<label for="customerNo">Nomor Pelanggan:</label>
<input type="text" id="customerNo" placeholder="Masukkan nomor pelanggan">

<!-- Tombol untuk memilih buyerSkuCode -->
<button onclick="setBuyerSkuCode('xld10')">Pilih xld10</button>
<button onclick="setBuyerSkuCode('9hp208')">Pilih xld10</button>
<button onclick="setBuyerSkuCode('9dcB35')">Pilih xld10</button>

<!-- Tombol Kirim -->
<button onclick="kirimPermintaan()">Kirim</button>

<!-- Kode JavaScript -->
<script>
    let customerNoInput = document.getElementById('customerNo');
    let selectedBuyerSkuCode = '';

    // Fungsi untuk mengatur nilai buyerSkuCode yang dipilih
    function setBuyerSkuCode(buyerSkuCode) {
        selectedBuyerSkuCode = buyerSkuCode;
        console.log('Buyer SKU Code terpilih: ' + selectedBuyerSkuCode);
    }

    // Fungsi untuk mengirim permintaan API
    function kirimPermintaan() {
        // Ganti nilai berikut dengan data sebenarnya
        const apiUrl = "https://cors-anywhere.herokuapp.com/https://api.digiflazz.com/v1/transaction";
        const username = "vimiheDaA0GD";
        const apiKey = "dev-d6f11b80-98b5-11ee-8c83-97c87b67c067";

        // Periksa apakah customerNo dan buyerSkuCode sudah terisi
        if (customerNoInput.value && selectedBuyerSkuCode) {
            // Hitung tanda tangan menggunakan CryptoJS MD5
            const refId = Date.now().toString(); // Gunakan timestamp sebagai ref_id
            const sign = CryptoJS.MD5(username + apiKey + refId).toString();

            // Persiapkan muatan permintaan
            const requestData = {
                username: username,
                buyer_sku_code: selectedBuyerSkuCode,
                customer_no: customerNoInput.value,
                ref_id: refId,
                sign: sign
            };

            // Lakukan permintaan API
            fetch(apiUrl, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(requestData)
            })
            .then(response => response.json())
            .then(data => {
                // Tangani respon API
                console.log(data);
                // Ekstrak data relevan dari respon dan perbarui HTML atau lakukan tindakan lebih lanjut berdasarkan data respon
            })
            .catch(error => console.error("Error:", error));
        } else {
            console.error('Mohon isi Nomor Pelanggan dan Pilih Kode Produk terlebih dahulu.');
        }
    }
</script>

</body>
</html>